헬름 사용방법

helm repo add 를 사용해서 등록된 페키지의 아티팩트허브의 경로를 등록한다.
ex - helm repo add {"edu"- 차트 저장소 대표하는 명 자유롭게 설정가능} {저장소 주소}

helm repo list로 정상적으로 등록됐는지 확인

helm repo update를 통해 변경된 정보를 캐시에 업데이트, 최신 차트 정보 동기화

helm install을 통해 패키지 설치
    install시 -- 를 통해서 변수 지정. 지정할 변수를 확인하기 위해서는 helm show values 명령으로 확인가능

<!-- 도커 레지스트리
직접 만든 이미지가 외부에 공개되기를 원하지 않는 경우도 있다
도커 허브에서 제공하는 private repository는 무료 사용자에게 1개밖에 허용하지 않으며 이미지 내려받는 횟주제한이 있으머
비공개 저장소는 유료 구독해야한다.

제약 없이 사용할 수 있는 저장소가 필요하면 레지스트리를 직접 구축하는 방법이 있다.
도커 레지스트리 이미지를 사용해 사설 도커 레지스트를 만들 수 있다.   -->

젠킨스를 헬름 차트로 설치해 애플리케이션을 사용하게 되면 젠킨스의 여러 설정 파일과 구성 파일들이 pvc를 통해 pv에 파일로 저장된다.
이때 pv에 적절한 접근 id를 부여하지 않으면 pvc를 사용해 파일을 읽고 쓰는 기능에 문제가 발생할 수 있다.
이를 방지하기 위해 uid와 gid를 1000번으로 변경
젠킨스 컨트롤러 이미지에서 기본적으로 사용하는 uid, gid가 1000번이기 때문이다.

현재 직접 구현이 아닌 실습파일로 대체한 내용들
환경 - vagrant, kubernetes, docker, cellico
쿠버네티스 - metallb(로드벨런서), docker registry, helm, jenkins(controller, agent, clusterrole), pv and pvc  

현재 설치된 젠킨스 구조
젠킨스 컨트롤러 - 마스터 노드
젠킨스 에이전트 - 필요 시 생성되고 작업을 마치면 삭제되는 임시적인 구조


마스터 노드에 생성되는 pod??
쿠버네티스에는 테인트와 톨러레이션 설정이있다.
매우 특별하게 취급돼야 하는 곳에는 테인트를 설정해, 쉽게 접근하지 못하는 소중한 것으로 설정한다.
톨러레이션이라는 특별한 키를 가져야만 이곳에 출입할 수 있다. 즉 현재 상태에서는 마스터 노드에 테인트가 설정돼 있어
특별한 목적으로 사용되는 노드라는 것을 명시해 두었다. 
일반적으로 마스터 노드 이외에도 GPU 노드, DB 전용 노드 등의 특별한 목적으로 사용 될 때 주로 사용

현재 실습 중인 젠킨스 컨트로러는 편의를 위해 여러 곳에 스케줄되지 않고 마스터 노드인 m-k8s에서만 스케줄 될 수 있도록 구성되었다.

컨트롤러와 에이전트따로 두는 이유:
젠킨스 컨트롤러를 단독으로 설치할 경우에는 컨트롤러가 설치된 서버에서 젠킨스 자체 시스템 관리, ci/cd 설정, 빌드 등의 작업을
모두 젠킨스 컨트롤러 단일 노드에서 수행한다. 하지만 컨트롤러-에이전트 구조로 설치할 경우 컨트롤러는 젠킨스 자체의 관리 및
ci/cd와 관련된 설정만을 담당하고 실제 빌드 작업은 에이전트로 설정된 노드에서 이루어진다.

쿠버네티스 위에 설치된 젠킨스는 작업 시 에이전트를 파드의 형태로 생성

jenkins pipeline 구성
code 수정 -> webhook -> git pull -> docker 이미지 build, push -> 쿠버네티스 deployment 생성, 외부 접속을 위한 서비스 생성 -> 변경 확인
    (nginx index.html파일로 수정으로 pipeline이 작동하는지 확인)
